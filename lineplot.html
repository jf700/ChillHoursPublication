<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publication Ready Chill Hours (0-1200)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: white; 
        }
        canvas {
            background-color: white;
        }
    </style>
</head>
<body class="p-8">

    <div class="max-w-5xl mx-auto">
        <div class="bg-white p-4">
            
            <div class="mb-6 text-center">
                <h1 class="text-3xl font-bold text-gray-900">Projected Chill Hours in Central California</h1>
                <p class="text-gray-600 mt-2">Comparison of Station Trends under SSP2-4.5 and SSP5-8.5 Scenarios</p>
            </div>

            <div class="relative h-[800px] w-full border border-gray-200">
                <canvas id="chillHoursChart"></canvas>
            </div>
            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- 1. DATA ---
            const ensembleYears = ['1985','2025', '2045', '2065', '2085'];
            const stationData = [
                { name: "Oakdale", ssp245: [1015.4,934.1, 896.3, 758.7, 677.1], ssp585: [1015.4,933.6, 729.1, 565.9, 414.6] },
                { name: "Denair II", ssp245: [997.9,940.0, 894.8, 766.4, 674.4], ssp585: [997.9,932.0, 731.5, 589.6, 452.3] },
                { name: "Linden", ssp245: [1000.7,953.9, 901.1, 770.1, 683.7], ssp585: [1000.7,955.6, 763.7, 582.5, 416.2] },
                { name: "Fresno State", ssp245: [931.5,990.6, 968.9, 839.0, 714.1], ssp585: [931.5,990.2, 807.4, 655.9, 477.1] },
                { name: "Firebaugh Telles", ssp245: [1039.7,853.9, 824.0, 696.4, 564.7], ssp585: [1039.7,849.7, 648.4, 498.3, 324.4] }
            ];

            // --- 2. STYLING CONSTANTS (High Contrast) ---
            const styles = [
                { color: '#0072B2', shape: 'circle' },   // Oakdale (Blue)
                { color: '#D55E00', shape: 'rect' },     // Denair (Vermillion)
                { color: '#009E73', shape: 'triangle' }, // Linden (Bluish Green)
                { color: '#CC79A7', shape: 'star' },     // Fresno (Reddish Purple)
                { color: '#E69F00', shape: 'crossRot' }  // Firebaugh (Orange)
            ];

            // --- 3. BUILD DATASETS ---
            const datasets = stationData.flatMap((station, index) => {
                const style = styles[index % styles.length];
                const baseConfig = {
                    fill: false,
                    tension: 0.1, 
                    borderWidth: 2.5,
                    pointRadius: 6,
                    pointBackgroundColor: style.color,
                    pointBorderColor: style.color, 
                    pointStyle: style.shape,
                };

                return [
                    { 
                        label: `${station.name} (SSP2-4.5)`, 
                        data: station.ssp245, 
                        borderColor: style.color,
                        borderDash: [], 
                        ...baseConfig 
                    },
                    { 
                        label: `${station.name} (SSP5-8.5)`, 
                        data: station.ssp585, 
                        borderColor: style.color,
                        borderDash: [10, 5], 
                        ...baseConfig 
                    }
                ];
            });

            // --- 4. CROP THRESHOLDS ---
            // Moved to the LEFT side (start) to ensure visibility
            const cropLineStyle = {
                type: 'line',
                borderColor: 'rgba(80, 80, 80, 0.7)', // Dark Grey
                borderWidth: 1.5,
                borderDash: [6, 4],
                scaleID: 'y',
                label: {
                    display: true,
                    // Position 'start' puts it on the left axis
                    position: 'start', 
                    backgroundColor: 'rgba(255, 255, 255, 1)', 
                    color: '#111',
                    font: { size: 12, weight: 'bold', family: 'Roboto' },
                    padding: 6,
                    borderWidth: 1,
                    borderColor: '#ccc',
                    borderRadius: 4,
                    // Slight vertical adjust to sit on top of the line
                    yAdjust: -12, 
                    // Slight horizontal adjust to move it inside the chart
                    xAdjust: 10,
                    z: 10 
                }
            };

            const annotations = {
                almondsVineyards: {
                    ...cropLineStyle,
                    yMin: 200, yMax: 200,
                    label: { ...cropLineStyle.label, content: 'Almonds / Vineyards (200)' }
                },
                peaches: {
                    ...cropLineStyle,
                    yMin: 650, yMax: 650,
                    label: { ...cropLineStyle.label, content: 'Peaches (650)' }
                },
                pistachios: {
                    ...cropLineStyle,
                    yMin: 800, yMax: 800,
                    label: { ...cropLineStyle.label, content: 'Pistachios (800)' }
                }
            };

            // --- 5. RENDER CHART ---
            const ctx = document.getElementById('chillHoursChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: { labels: ensembleYears, datasets: datasets },
                options: {
                    events: [], // Static chart
                    animation: false, 
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: { top: 20, right: 20, bottom: 20, left: 10 } 
                    },
                    scales: {
                        x: {
                            display: true,
                            title: { display: true, text: 'Ensemble Year', font: { size: 16, weight: 'bold' }, color: 'black' },
                            ticks: { font: { size: 14 }, color: 'black' },
                            grid: { display: false }
                        },
                        y: {
                            display: true,
                            title: { display: true, text: 'Chill Hours (Utah Model)', font: { size: 16, weight: 'bold' }, color: 'black' },
                            ticks: { font: { size: 14 }, color: 'black' },
                            min: 0, 
                            max: 1200
                        }
                    },
                    plugins: {
                        tooltip: { enabled: false }, 
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 25,
                                font: { size: 13, family: 'Roboto' },
                                color: 'black',
                                boxWidth: 10
                            }
                        },
                        annotation: {
                            clip: false, 
                            annotations: annotations
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>